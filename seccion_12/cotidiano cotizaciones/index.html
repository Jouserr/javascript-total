<!DOCTYPE html>
<head>
    <title>Cotidiano cotizaciones</title>
    <link rel="stylesheet" href="misEstilos.css">
</head>
<body>
    <div id="contenedor">
        <h1 id="titulo">Cotizaciones Online</h1>
        <div id="eurUsd" class="cotizacion">Euro a Dólares: ...</div>
        <div id="crcUsd" class="cotizacion">Colones a Dólares: ...</div>
        <div id="bitcoinUsd" class="cotizacion">Bitcoin a USD: ...</div>
    </div>
</body>
<script>
   
async function cargarContenido() {
    await delay(2500); 
    cargarElementos();
    cargarTextos();
    cargarCotizaciones(mostrarCotizacion);
}


function cargarCotizaciones(callback) {
    
    fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd')
        .then(res => res.json())
        .then(data => callback('bitcoin', data))
        .catch(() => callback('bitcoin', null));

   
    fetch('https://open.er-api.com/v6/latest/EUR')
        .then(res => res.json())
        .then(data => callback('eur', data))
        .catch(() => callback('eur', null));


    crearPedido('https://open.er-api.com/v6/latest/USD', function(data) {
        callback('crc', data);
    });
}


function mostrarCotizacion(tipo, datos) {
    if (tipo === 'bitcoin') {
        if (datos && datos.bitcoin && datos.bitcoin.usd) {
            document.getElementById('bitcoinUsd').textContent =
                `Bitcoin a USD: ${datos.bitcoin.usd.toLocaleString('en-US', {style: 'currency', currency: 'USD'})}`;
        } else {
            document.getElementById('bitcoinUsd').textContent = 'Bitcoin a USD: Error al obtener datos';
        }
    }
    if (tipo === 'eur') {
        if (datos && datos.rates && datos.rates.USD) {
            document.getElementById('eurUsd').textContent =
                `Euro a Dólares: ${datos.rates.USD}`;
        } else {
            document.getElementById('eurUsd').textContent = 'Euro a Dólares: Error al obtener datos';
        }
    }
    if (tipo === 'crc') {
        if (datos && datos.rates && datos.rates.CRC) {

            const tasaCrcToUsd = 1 / datos.rates.CRC;
            document.getElementById('crcUsd').textContent =
                `Colones a Dólares: ${tasaCrcToUsd.toFixed(5)}`;
        } else {
            document.getElementById('crcUsd').textContent = 'Colones a Dólares: Error al obtener datos';
        }
    }
}


function crearPedido(url, callback) {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', url);
    xhr.onload = function() {
        if (xhr.status === 200) {
            try {
                const data = JSON.parse(xhr.responseText);
                callback(data);
            } catch {
                callback(null);
            }
        } else {
            callback(null);
        }
    };
    xhr.onerror = function() {
        callback(null);
    };
    xhr.send();
}


function cargarElementos() {
    document.getElementById('titulo').textContent = "Cotizaciones Online";
}


function cargarTextos() {
    document.getElementById('eurUsd').textContent = "Euro a Dólares: ...";
    document.getElementById('crcUsd').textContent = "Colones a Dólares: ...";
    document.getElementById('bitcoinUsd').textContent = "Bitcoin a USD: ...";
}


function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}


window.onload = cargarContenido;
</script>
</html>